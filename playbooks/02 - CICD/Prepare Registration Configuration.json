{
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "Prepare Registration Configuration",
    "aliasName": null,
    "tag": null,
    "description": "Create Change Management appliance and Change Management Configuration in attachment module",
    "isActive": false,
    "debug": false,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [],
    "synchronous": false,
    "collection": "\/api\/3\/workflow_collections\/4c58fed3-9e16-451a-9528-0be2b71acda4",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/73d63db3-20db-454b-92ec-0ab178ab9e46",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "Delete Configuration File",
            "description": null,
            "arguments": {
                "config": "4540c845-5d7d-4336-aeec-9f4f508d38d1",
                "params": {
                    "python_function": "import pathlib\nfilename = '{{vars.filename}}'\n\nfilepath = '\/tmp\/{0}'.format(filename)\n\npath = pathlib.Path(filepath)\npath.unlink()"
                },
                "version": "2.0.1",
                "connector": "code-snippet",
                "operation": "python_inline_code_editor",
                "operationTitle": "Execute Python Code",
                "step_variables": []
            },
            "status": null,
            "top": "975",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/1fdd14cc-d6b4-4335-a3af-ab49c8ed2fd8",
            "group": null,
            "uuid": "0e29a87f-d838-4b33-b779-4d978ca2c5e2"
        },
        {
            "@type": "WorkflowStep",
            "name": "Prepare Configuration Info",
            "description": null,
            "arguments": {
                "config_info": "{\"public_key\": \"{{vars.steps.Get_Auth_Users.data.pubkey}}\", \n\"private_key\": \"{{vars.steps.Get_Auth_Users.data.pkey}}\",\n\"server_type\": \"{{vars.input.params.selectServerType}}\",\n\"api_endpoint\": \"{{vars.api_endpoint}}\" \n}"
            },
            "status": null,
            "top": "570",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "1ceb2ec2-23c8-4bcb-877f-baedfbe22958"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get Auth Users",
            "description": null,
            "arguments": {
                "params": {
                    "iri": "\/api\/auth\/users",
                    "body": "{\"credentials\":{\"loginid\":null},\"domain\":\"{{globalVars.Server_fqhn}}\",\"type\":3,\"nfa\":[],\"tenant\":\"exo-ui\",\"status\":1,\"bind_name\":null}",
                    "method": "POST"
                },
                "version": "3.2.1",
                "connector": "cyops_utilities",
                "operation": "make_cyops_request",
                "operationTitle": "FSR: Make FortiSOAR API Call",
                "step_variables": []
            },
            "status": null,
            "top": "300",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/0109f35d-090b-4a2b-bd8a-94cbc3508562",
            "group": null,
            "uuid": "4b58a104-93b8-4db4-8855-db54f0ad4f18"
        },
        {
            "@type": "WorkflowStep",
            "name": "Create Configuration File",
            "description": null,
            "arguments": {
                "config": "4540c845-5d7d-4336-aeec-9f4f508d38d1",
                "params": {
                    "python_function": "\nimport json\n \n# Data to be written\ndictionary = {{vars.config_info}}\n \n# Serializing json\njson_object = json.dumps(dictionary, indent=4)\n\nfilename = '{{vars.filename}}'\n\nfilepath = '\/tmp\/{0}'.format(filename)\n\nwith open(filepath, \"w\") as outfile:\n    outfile.write(json_object)"
                },
                "version": "2.0.1",
                "connector": "code-snippet",
                "operation": "python_inline_code_editor",
                "operationTitle": "Execute Python Code",
                "step_variables": []
            },
            "status": null,
            "top": "705",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/1fdd14cc-d6b4-4335-a3af-ab49c8ed2fd8",
            "group": null,
            "uuid": "54cb9aa3-09f3-4f00-8022-87e3ef5ac694"
        },
        {
            "@type": "WorkflowStep",
            "name": "Create Configuration Attachment",
            "description": null,
            "arguments": {
                "params": {
                    "name": "Change Management Configuration",
                    "filename": "\/tmp\/{{vars.filename}}",
                    "description": "",
                    "request_headers": "",
                    "multipart_headers": "",
                    "extra_multipart_fields": ""
                },
                "version": "3.2.1",
                "connector": "cyops_utilities",
                "operation": "create_cyops_attachment",
                "operationTitle": "File: Create Attachment from File",
                "step_variables": []
            },
            "status": null,
            "top": "840",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/0109f35d-090b-4a2b-bd8a-94cbc3508562",
            "group": null,
            "uuid": "562d8027-273f-4889-ace6-20d8e2321720"
        },
        {
            "@type": "WorkflowStep",
            "name": "Configuration",
            "description": null,
            "arguments": {
                "filename": "cm_{{vars.request.headers.host.split('.')[0]}}_config.json",
                "api_endpoint": "https:\/\/{{vars.request.headers.host}}\/api\/triggers\/1\/changeMangement",
                "appliance_name": "Change Management"
            },
            "status": null,
            "top": "165",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "6f9f1102-349e-4540-a69d-ebb198b13b3d"
        },
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "route": "338a14fb-7f45-4d4c-b3f1-b12e8aa68627",
                "resources": [
                    "change_requests"
                ],
                "inputVariables": [
                    {
                        "name": "selectServerType",
                        "type": "array",
                        "label": "Select Server Type",
                        "title": "Dynamic List",
                        "usable": true,
                        "options": [
                            "Development",
                            "Staging"
                        ],
                        "tooltip": "Select the current server type",
                        "dataType": "dynamicList",
                        "formType": "dynamicList",
                        "required": false,
                        "_expanded": true,
                        "mmdUpdate": true,
                        "collection": false,
                        "searchable": false,
                        "templateUrl": "app\/components\/form\/fields\/dynamicList.html",
                        "defaultValue": "Development",
                        "_previousName": "selectServerTy",
                        "lengthConstraint": true,
                        "allowedGridColumn": false,
                        "useRecordFieldDefault": false
                    }
                ],
                "step_variables": {
                    "input": {
                        "params": {
                            "selectServerType": "{{vars.request.data[\"selectServerType\"]}}"
                        },
                        "records": "{{vars.input.records}}"
                    }
                },
                "_promptexpanded": true,
                "displayConditions": {
                    "change_requests": {
                        "sort": [],
                        "limit": 30,
                        "logic": "AND",
                        "filters": []
                    }
                },
                "executeButtonText": "Execute",
                "noRecordExecution": true,
                "singleRecordExecution": false
            },
            "status": null,
            "top": "30",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/f414d039-bb0d-4e59-9c39-a8f1e880b18a",
            "group": null,
            "uuid": "73d63db3-20db-454b-92ec-0ab178ab9e46"
        },
        {
            "@type": "WorkflowStep",
            "name": "Show Registration Config Details",
            "description": null,
            "arguments": {
                "type": "DecisionBased",
                "input": {
                    "schema": {
                        "title": "Registration Configuration",
                        "description": "<a href=\"\/modules\/view-panel\/attachments\/{{vars.steps.Create_Configuration_Attachment.data.uuid}}\" target=\"_blank\">Change Management Configuration<\/a> attachment record has been created with filename {{vars.filename}}.\n<br>\nPlease download and use while configuring the \"FortiSOAR Change Management\" connector to synchronize the change requests records.",
                        "inputVariables": []
                    }
                },
                "record": "",
                "resources": "change_requests",
                "owner_detail": {
                    "isAssigned": false
                },
                "isRecordLinked": false,
                "step_variables": [],
                "response_mapping": {
                    "options": [
                        {
                            "option": "OK",
                            "primary": true,
                            "step_iri": "\/api\/3\/workflow_steps\/c8dbf691-62ee-4342-bfb3-a14c2f7c8919"
                        }
                    ],
                    "duplicateOption": false
                },
                "email_notification": {
                    "enabled": false,
                    "smtpParameters": []
                }
            },
            "status": null,
            "top": "1110",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/fc04082a-d7dc-4299-96fb-6837b1baa0fe",
            "group": null,
            "uuid": "923b79ea-3778-441c-99ba-02db79be0dfa"
        },
        {
            "@type": "WorkflowStep",
            "name": "No Operation",
            "description": null,
            "arguments": {
                "params": [],
                "version": "3.2.1",
                "connector": "cyops_utilities",
                "operation": "no_op",
                "operationTitle": "Utils: No Operation",
                "step_variables": []
            },
            "status": null,
            "top": "1245",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/0109f35d-090b-4a2b-bd8a-94cbc3508562",
            "group": null,
            "uuid": "c8dbf691-62ee-4342-bfb3-a14c2f7c8919"
        },
        {
            "@type": "WorkflowStep",
            "name": "Create Appliances",
            "description": null,
            "arguments": {
                "params": {
                    "iri": "\/api\/3\/appliances",
                    "body": "{\"name\":\"{{vars.appliance_name}}\",\"roles\":[\"\/api\/3\/roles\/21d7a7c6-9d68-438f-b732-e8950c5f745b\",\"\/api\/3\/roles\/d68596a0-e4bd-4477-9108-15ef0fc4ee4f\"],\"teams\":[\"\/api\/3\/teams\/6e569c09-3bd4-40f1-98b0-cc994464c3c5\"],\"userId\":\"{{vars.steps.Get_Auth_Users.data. uuid}}\",\"activeStatus\":1,\"lockedStatus\":0}",
                    "method": "POST"
                },
                "version": "3.2.1",
                "connector": "cyops_utilities",
                "operation": "make_cyops_request",
                "operationTitle": "FSR: Make FortiSOAR API Call",
                "step_variables": []
            },
            "status": null,
            "top": "435",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/0109f35d-090b-4a2b-bd8a-94cbc3508562",
            "group": null,
            "uuid": "ef035c8f-1912-4b17-ab84-0cce6838a4ed"
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "Create Appliances -> Configuration",
            "targetStep": "\/api\/3\/workflow_steps\/1ceb2ec2-23c8-4bcb-877f-baedfbe22958",
            "sourceStep": "\/api\/3\/workflow_steps\/ef035c8f-1912-4b17-ab84-0cce6838a4ed",
            "label": null,
            "isExecuted": false,
            "uuid": "0379a4e0-5cfe-4c4b-a239-4e3ae8dc2805"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Configuration -> Get Auth Users",
            "targetStep": "\/api\/3\/workflow_steps\/4b58a104-93b8-4db4-8855-db54f0ad4f18",
            "sourceStep": "\/api\/3\/workflow_steps\/6f9f1102-349e-4540-a69d-ebb198b13b3d",
            "label": null,
            "isExecuted": false,
            "uuid": "2d475cac-b8b4-45e9-9aa0-5508be0d003e"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Show Registration Config Details -> No Operation",
            "targetStep": "\/api\/3\/workflow_steps\/c8dbf691-62ee-4342-bfb3-a14c2f7c8919",
            "sourceStep": "\/api\/3\/workflow_steps\/923b79ea-3778-441c-99ba-02db79be0dfa",
            "label": "OK",
            "isExecuted": false,
            "uuid": "622f1a87-f757-4345-89e0-50e74e40e385"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Create Configuration Attachment -> Delete Configuration File",
            "targetStep": "\/api\/3\/workflow_steps\/0e29a87f-d838-4b33-b779-4d978ca2c5e2",
            "sourceStep": "\/api\/3\/workflow_steps\/562d8027-273f-4889-ace6-20d8e2321720",
            "label": null,
            "isExecuted": false,
            "uuid": "76e0a30d-0eaa-4c05-a986-7a1c268a510a"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Pretty Print JSON String -> Create Configuration File",
            "targetStep": "\/api\/3\/workflow_steps\/562d8027-273f-4889-ace6-20d8e2321720",
            "sourceStep": "\/api\/3\/workflow_steps\/54cb9aa3-09f3-4f00-8022-87e3ef5ac694",
            "label": null,
            "isExecuted": false,
            "uuid": "9267b7a9-efc3-42c3-a764-6439eb9de50f"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Delete Configuration File -> Show Registration Config Details",
            "targetStep": "\/api\/3\/workflow_steps\/923b79ea-3778-441c-99ba-02db79be0dfa",
            "sourceStep": "\/api\/3\/workflow_steps\/0e29a87f-d838-4b33-b779-4d978ca2c5e2",
            "label": null,
            "isExecuted": false,
            "uuid": "b95d7d28-08ab-4064-8e5d-81ab0fa6eec8"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Get Auth Users -> Create Appliances",
            "targetStep": "\/api\/3\/workflow_steps\/ef035c8f-1912-4b17-ab84-0cce6838a4ed",
            "sourceStep": "\/api\/3\/workflow_steps\/4b58a104-93b8-4db4-8855-db54f0ad4f18",
            "label": null,
            "isExecuted": false,
            "uuid": "c0350f83-805f-4b8b-b4c7-c6f2d59bb892"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Start -> Configuration",
            "targetStep": "\/api\/3\/workflow_steps\/6f9f1102-349e-4540-a69d-ebb198b13b3d",
            "sourceStep": "\/api\/3\/workflow_steps\/73d63db3-20db-454b-92ec-0ab178ab9e46",
            "label": null,
            "isExecuted": false,
            "uuid": "d9d2337b-97b1-4aba-b9fc-82fcf4e8253c"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Configuration -> Pretty Print JSON String",
            "targetStep": "\/api\/3\/workflow_steps\/54cb9aa3-09f3-4f00-8022-87e3ef5ac694",
            "sourceStep": "\/api\/3\/workflow_steps\/1ceb2ec2-23c8-4bcb-877f-baedfbe22958",
            "label": null,
            "isExecuted": false,
            "uuid": "f263abac-8d10-42f2-850c-353c0c4c89c8"
        }
    ],
    "groups": [],
    "priority": "\/api\/3\/picklists\/2b563c61-ae2c-41c0-a85a-c9709585e3f2",
    "uuid": "c44ff0f3-2a23-4719-965e-d8e1217bab68",
    "owners": [],
    "isPrivate": false,
    "deletedAt": null,
    "recordTags": [
        "ManualTrigger",
        "CICD"
    ]
}